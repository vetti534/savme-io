name: Deploy to Hostinger

on:
  push:
    branches:
      - main

jobs:
  web-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest
    steps:
      - name: ğŸšš Get latest code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¦ Install Dependencies
        run: npm ci

      - name: ğŸ—ï¸ Build Project
        run: npm run build

      - name: ğŸ”§ Copy PHP Proxy
        run: cp public/gemini-proxy.php out/gemini-proxy.php

      - name: ğŸš€ Turbo Deploy (LFTP)
        run: |
          sudo apt-get update
          sudo apt-get install -y lftp
          lftp -c "set ftp:ssl-force true; set ssl:verify-certificate no; open -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ${{ secrets.FTP_SERVER }}; mirror -R -v -P 30 --exclude-glob .git* --exclude-glob .github* ./out/ domains/savme.io/public_html"
